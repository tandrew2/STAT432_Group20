---
title: "Wine Modelling Analysis"
author: "Theodore Andrew, Alicia Lo, Sumit Patel"
date: "5/5/2018"
output: html_document
---


```{r include=FALSE}
# general
library(MASS)
library(caret)
library(tidyverse)
library(knitr)
library(kableExtra)
library(mlbench)

# specific
library(ISLR)
library(nnet)
library(ellipse)
library(randomForest)
library(gbm)
library(glmnet)
library(rpart)
library(rpart.plot)
library(ggplot2)
```


```{r}
wine = read.csv("wine.csv")
wine = wine[,-c(1, 2)]
wine$quality = as.factor(wine$quality)
```


```{r}
# Test-split the data
set.seed(42)
wine_idx = createDataPartition(wine$quality, p = 0.75, list = FALSE)
wine_trn = wine[wine_idx,]
wine_tst = wine[-wine_idx,]
```

Variable Selection Method

```{r}
y = as.numeric(wine$quality)
X = model.matrix(quality ~ ., wine)[, -12]

wine_lasso = cv.glmnet(X, y, alpha = 1)
plot(wine_lasso)
coef(wine_lasso, s = "lambda.1se")
```


Modelling Analysis

```{r}
calc_rmse = function(actual, predicted) {
  sqrt(mean((actual - predicted) ^ 2))
}
```

Multinomial Logistic Regression

```{r message=FALSE, warning=FALSE, include=FALSE}
wine_multi = train(quality ~ .,
                   data = wine_trn,
                   method = "multinom",
                   trControl = trainControl(method = "cv", number = 5)
                   )
```

KNN (without scaling)

```{r message=FALSE, warning=FALSE, include=FALSE}
wine_knn_wo = train(quality ~ .,
                    data = wine_trn,
                    method = "knn",
                    trControl = trainControl(method = "cv", number = 5)
                    )
```

KNN (with scaling)

```{r message=FALSE, warning=FALSE, include=FALSE}
wine_knn_sc = train(quality ~ .,
                    data = wine_trn,
                    method = "knn",
                    trControl = trainControl(method = "cv", number = 5),
                    preProcess = c("center", "scale")
                    )
```

LDA

```{r message=FALSE, warning=FALSE, include=FALSE}
class_lda_mod = train(
  quality ~ .,
  data = wine_trn,
  trControl = trainControl(method = "cv", number = 10),
  method = "lda"
)
```

RDA

```{r message=FALSE, warning=FALSE, include=FALSE}
class_rda_mod = train(
  quality ~ .,
  data = wine_trn,
  trControl = trainControl(method = "cv", number = 5),
  method = "rda"
)
```

NB

```{r message=FALSE, warning=FALSE, include=FALSE}
wine_nb = train(quality ~ .,
                 data = wine_trn,
                 method = "nb",
                 trControl = trainControl(method = "cv", number = 5)
                 )
```

Elastic Net

```{r message=FALSE, warning=FALSE, include=FALSE}
wine_elnet = train(quality ~ .,
                   data = wine_trn,
                   method = "glmnet",
                   trControl = trainControl(method = "cv", number = 5)
                   )
```

Tree

```{r message=FALSE, warning=FALSE, include=FALSE}
wine_tree = train(quality ~ .,
                   data = wine_trn,
                   method = "rpart",
                   trControl = trainControl(method = "cv", number = 5)
                   )
```

RF

```{r message=FALSE, warning=FALSE, include=FALSE}
set.seed(9034)
wine_rf = train(quality ~ .,
                data = wine_trn,
                method = "rf",
                trControl = trainControl(method = "oob"),
                importance = T
                )
```

GBM

```{r message=FALSE, warning=FALSE, include=FALSE}
set.seed(9034)
wine_gbm = train(quality ~ .,
                 data = wine_trn,
                 method = "gbm",
                 trControl = trainControl(method = "cv", number = 5),
                 verbose = F
                 )
```


```{r message=FALSE, warning=FALSE, include=FALSE}
model_list = list(wine_multi, wine_knn_wo, wine_knn_sc, class_lda_mod, class_rda_mod,
                  wine_nb, wine_elnet, wine_tree, wine_rf, wine_gbm)

pred_model = lapply(model_list, predict, newdata = wine_tst)

for(i in 1:length(pred_model)){
  pred_model[[i]] = as.numeric(pred_model[[i]])
}

testing_rmse_model = sapply(pred_model, calc_rmse,
                            actual = as.numeric(wine_tst$quality))

model_method = c("Multinomial Logistic Regression",
                 "KNN without scaling",
                 "KNN with scaling",
                 "LDA",
                 "RDA",
                 "Naive Bayes",
                 "Elastic Net",
                 "Tree",
                 "Random Forest",
                 "Gradient Boosted Model"
                 )

class_summary = data.frame(model_method, testing_rmse_model)
colnames(class_summary) = c("Model Method", "Testing RMSE")
```


```{r}
kable_styling(kable(class_summary, format = "html", digits = 4, main = "Wine Quality Testing RMSE"), full_width = F)
```











